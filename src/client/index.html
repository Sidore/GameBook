<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>React + TypeScript</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div id="main"></div>

  <input type="text" id="login"> login <br>
  <input type="text" id="password"> pass <br>
  <input type="text" id="email"> email <br>
  <input type="text" id="room"> new Room <br>

  <button id="register">register</button>
  <button id="loginB">login</button>

  <!-- <button id="sender">send json</button> -->
  <button id="game">try get room</button>
  <button id="room1">try create room</button>
  <p id="output">

  </p>

  <ul id="list">

  </ul>

    <script>
      let token = "";
      let senderButton1 = document.getElementById("loginB");
      senderButton1.onclick = function(){
          let req = new XMLHttpRequest();
          req.open('POST', 'http://localhost:2503/api/auth'); 
          req.setRequestHeader("Content-Type", "application/json");
          req.onreadystatechange = function() {
          if (req.readyState == 4) {
              // if(req.status == 200) {
                  document.getElementById("output").innerHTML = req.responseText;
                  console.log(JSON.parse(req.responseText));
                  token = JSON.parse(req.responseText).token;
              // }
          }
          };
          console.log("login")
          req.send(JSON.stringify({
              email : document.getElementById("email").value,
              password : document.getElementById("password").value
          }));
      }
  
      let senderButton = document.getElementById("register");
      senderButton.onclick = function(){
          let req = new XMLHttpRequest();
          req.open('POST', 'http://localhost:2503/api/user'); 
          req.setRequestHeader("Content-Type", "application/json");
          req.onreadystatechange = function() {
          if (req.readyState == 4) {
              // if(req.status == 200) {
                  document.getElementById("output").innerHTML = req.responseText;
                  console.log(JSON.parse(req.responseText));
                  token = JSON.parse(req.responseText).token;
              // }
          }
          };

        //   console.log({
        //     login : document.getElementById("login").value,
        //     password : document.getElementById("password").value,
        //     email : document.getElementById("email").value,
        // });
          req.send(JSON.stringify({
              name : document.getElementById("login").value,
              password : document.getElementById("password").value,
              email : document.getElementById("email").value,
          }));
      }
  
      // let senderButton = document.getElementById("");
      // senderButton.onclick = function(){
      //     let req = new XMLHttpRequest();
      //     req.open('POST', '/login'); 
      //     req.setRequestHeader("Content-Type", "application/json");
      //     req.onreadystatechange = function() {
      //     if (req.readyState == 4) {
      //         if(req.status == 200) {
      //             document.getElementById("output").innerHTML = req.responseText;
      //             console.log(JSON.parse(req.responseText));
      //             token = JSON.parse(req.responseText).token;
      //         }
      //     }
      //     };
      //     req.send(JSON.stringify({
      //         login : document.getElementById("login").value,
      //         password : document.getElementById("password").value
      //     }));
      // }
  
      let gameButton = document.getElementById("game");
      gameButton.onclick = function(){
          let req = new XMLHttpRequest();
          req.open('GET', 'http://localhost:2503/api/gameroom'); 
          req.setRequestHeader("Content-Type", "application/json");
          req.setRequestHeader("Authorization", "Bearer " + token);
          req.onreadystatechange = function() {
          if (req.readyState == 4) {
              if(req.status == 200) {

                  const response = JSON.parse(req.responseText);
                  const list = document.getElementById("list");

                  response.forEach(element => {
                      let el = document.createElement("li");
                      el.innerHTML = element.name;
                      list.appendChild( el );
                  });
                  
                //   .innerHTML = req.responseText;
                  
                  if (response.redirect) {
                      setTimeout(() => {
                          window.location.assign(response.redirect);
                      }, 2000);
                  }
              }
          }
          };
  
          req.send();
      }

      let senderButton2 = document.getElementById("room1");
      senderButton2.onclick = function(){
          let req = new XMLHttpRequest();
          req.open('POST', 'http://localhost:2503/api/gameroom'); 
          req.setRequestHeader("Content-Type", "application/json");
          req.setRequestHeader("Authorization", "Bearer " + token);
          req.onreadystatechange = function() {
          if (req.readyState == 4) {
              // if(req.status == 200) {
                  document.getElementById("output").innerHTML = req.responseText;
                  console.log(JSON.parse(req.responseText));
              // }
          }
          };
          req.send(JSON.stringify({
              name : document.getElementById("room").value,
          }));
      }
  </script>  
  <script src="./App.tsx"></script>
</body>
</html>